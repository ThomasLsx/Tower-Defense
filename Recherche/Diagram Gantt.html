<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagramme de Gantt - Projet Tower Defense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .gantt-chart-container {
            position: relative;
            overflow-x: auto;
            white-space: nowrap;
            padding-top: 2rem;
            padding-bottom: 2rem;
            user-select: none;
            /* Force a wider container for scrolling */
            min-width: 1200px;
        }
        .gantt-header-row, .gantt-task-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .gantt-header-label {
            min-width: 400px;
            flex-shrink: 0;
            font-weight: 600;
            padding-left: 0.5rem;
            text-align: left;
            font-size: 1rem;
            color: #a0aec0;
        }
        .gantt-timeline {
            display: flex;
            flex-grow: 1;
            height: 2rem;
            background-color: #2d3748;
            border-radius: 0.5rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .gantt-month {
            flex-grow: 1;
            text-align: center;
            font-weight: 600;
            line-height: 2rem;
            position: relative;
        }
        .gantt-month::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 1px;
            background-color: #4a5568;
        }
        .gantt-task-label {
            min-width: 400px;
            flex-shrink: 0;
            font-weight: 600;
            padding-left: 0.5rem;
            white-space: nowrap;
        }
        .gantt-task-label.sub-task {
            padding-left: 2rem; /* Indentation pour les sous-tâches */
            font-weight: 400;
        }
        .gantt-task-bar-container {
            flex-grow: 1;
            height: 2rem;
            margin-left: 0.5rem;
            position: relative;
        }
        .gantt-task-bar {
            position: absolute;
            top: 0;
            height: 100%;
            background-color: #4299e1;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .gantt-task-bar:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        .gantt-tooltip {
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2d3748;
            color: #cbd5e0;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            z-index: 20;
            white-space: normal;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            min-width: 200px;
        }
        .gantt-task-bar:hover .gantt-tooltip {
            opacity: 1;
        }
    </style>
</head>
<body class="p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-extrabold mb-2 text-center text-indigo-400">Diagramme de Gantt</h1>
        <p class="text-lg text-gray-400 mb-8 text-center">Visualisation du planning du projet Tower Defense</p>

        <!-- Message pour le slider -->
        <div class="text-center text-gray-400 mb-4 animate-pulse">
            <p>Faites défiler le diagramme de gauche à droite pour voir toutes les tâches !</p>
        </div>

        <div id="gantt-chart" class="bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <!-- Le diagramme sera généré ici par JavaScript -->
            <div class="gantt-chart-container">
                <!-- Les barres seront ajoutées ici -->
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Données du CSV encodées en tant que chaîne de caractères
            const csvData = `ID,Tâche,Début,Fin,Durée_jours,Dépendance,Assigné,Notes
1,Recherche & spécification,2025-09-01,2025-09-14,14,,Thomas & Lilian,"Lire le sujet, trouver exemples (A*), rédiger le spec et MVP"
1.1,Lire sujet & définir périmètre,2025-09-01,2025-09-02,2,1,Thomas & Lilian,Clarifier ce qui est dans le MVP
1.2,"Recherche références (GitHub, SFML, A*)",2025-09-03,2025-09-05,3,1,Thomas & Lilian,"Réutiliser/explorer codes existants"
1.3,Rédaction du cahier des charges,2025-09-06,2025-09-08,3,1,Thomas & Lilian,"Liste des tours, ennemis, UI minimale"
1.4,Architecture & diagramme de classes,2025-09-09,2025-09-11,3,1,Thomas & Lilian,Décider des modules
1.5,Validation spec / milestone,2025-09-12,2025-09-14,3,1,Thomas & Lilian,Milestone: Spec validé
2,Setup projet & carte (SFML),2025-09-15,2025-09-28,14,1.5,Thomas & Lilian,"Intégration SFML, carte fixe, grille, interactions"
2.1,Setup projet et visual studio,2025-09-15,2025-09-16,2,2,Thomas,Prévoir libs
2.2,Création de la carte (fixe),2025-09-17,2025-09-19,3,2,Thomas,Fond noir ou image
2.3,Implémentation de la grille,2025-09-20,2025-09-22,3,2.2,Thomas,Cellules pour placement
2.4,"Interaction souris (hover, clic)",2025-09-23,2025-09-25,3,2.3,Thomas,"Highlight case, placer/vendre tour"
2.5,"Tests unitaires (carte, interactions)",2025-09-26,2025-09-28,3,2.4,Thomas & Lilian,Valider les fonctions de base
3,Gestion du gameplay de base,2025-09-29,2025-10-12,14,2.5,Thomas & Lilian,"Entités, déplacement simple, affichage"
3.1,Création de la classe Entité,2025-09-29,2025-10-01,3,3,Lilian,Attributs de base (HP, pos, etc.)
3.2,Générateur d'ennemis (simple spawn),2025-10-02,2025-10-04,3,3.1,Lilian,Ennemis qui suivent une ligne droite
3.3,Affichage des entités,2025-10-05,2025-10-07,3,3.2,Thomas,Sprites/formes
3.4,Animation de déplacement simple,2025-10-08,2025-10-10,3,3.3,Thomas,Ennemis qui avancent
3.5,Implémentation du "hitbox" basique,2025-10-11,2025-10-12,2,3.4,Lilian,Détection de collision simple
4,Gestion des vagues,2025-10-13,2025-10-26,14,3.5,Thomas & Lilian,"Pathfinding, collisions, vagues, spawn"
4.1,"Recherche & implémentation A*",2025-10-13,2025-10-19,7,4,Lilian,"Algorithme de chemin (grid-based)"
4.2,Implémentation du gestionnaire de vagues,2025-10-20,2025-10-22,3,4.1,Thomas,"Spawn d'ennemis à intervalles réguliers"
4.3,"Déplacement des ennemis (Pathfinding)",2025-10-23,2025-10-26,4,4.2,Lilian,"Ennemis qui suivent le chemin optimal"
5,Gameplay des tourelles (attaques & améliorations),2025-11-03,2025-11-23,21,4.3,Thomas & Lilian,"4-5 types, upgrades, effets spéciaux"
5.1,Création de 4-5 types de tours (code),2025-11-03,2025-11-08,6,5,Lilian,"Projiles, AoE, slow, burst"
5.2,Système de ciblage des tours,2025-11-09,2025-11-12,4,5.1,Thomas,Cibler le plus proche, le plus fort, etc.
5.3,Gestion des projectiles & dégâts,2025-11-13,2025-11-16,4,5.2,Thomas,"Trajectoire, collision, dégâts"
5.4,Système d'améliorations (UI & logique),2025-11-17,2025-11-20,4,5.3,Lilian,"Coûts, stats améliorées"
5.5,Tests gameplay tourelles,2025-11-21,2025-11-23,3,5.4,Thomas & Lilian,Équilibrage
6,Finitions & UI,2025-11-24,2025-11-30,7,5.5,Thomas & Lilian,"Points de vie, argent, sons, graphismes"
6.1,"Système de vie & défaite",2025-11-24,2025-11-25,2,6,Thomas & Lilian,"Barre de vie, écran de game over"
6.3,"Finitions graphiques, sons, UI",2025-11-28,2025-11-30,3,6.2,Thomas & Lilian,"Icônes, musique, effets sonores, etc."`;

            const parseCSV = (csv) => {
                const lines = csv.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                return lines.slice(1).map(line => {
                    const values = line.match(/(?:[^,"]+|"[^"]*")+/g).map(v => v.trim().replace(/"/g, ''));
                    return headers.reduce((obj, header, index) => {
                        obj[header] = values[index];
                        return obj;
                    }, {});
                });
            };

            const renderGanttChart = (data) => {
                const container = document.querySelector('#gantt-chart .gantt-chart-container');
                if (!container) return;
                
                // Convertir les dates en objets Date et trouver la période totale
                const tasks = data.map(task => ({
                    ...task,
                    start: new Date(task.Début),
                    end: new Date(task.Fin)
                }));
                
                const minDate = tasks.reduce((min, t) => t.start < min ? t.start : min, new Date('2025-12-31'));
                const maxDate = tasks.reduce((max, t) => t.end > max ? t.end : max, new Date('2025-01-01'));
                const totalDays = (maxDate - minDate) / (1000 * 60 * 60 * 24);

                // Créer l'en-tête de la timeline avec le label "Tâche"
                const headerRow = document.createElement('div');
                headerRow.className = 'gantt-header-row';

                const headerLabel = document.createElement('div');
                headerLabel.className = 'gantt-header-label';
                headerLabel.textContent = 'Tâche';
                headerRow.appendChild(headerLabel);

                const timelineDiv = document.createElement('div');
                timelineDiv.className = 'gantt-timeline';
                
                const months = ['Septembre', 'Octobre', 'Novembre', 'Décembre'];
                const monthStarts = [new Date('2025-09-01'), new Date('2025-10-01'), new Date('2025-11-01')];
                const totalWidthInDays = (new Date('2025-12-01') - new Date('2025-09-01')) / (1000 * 60 * 60 * 24);

                months.forEach((month, index) => {
                    if (index > 2) return;
                    const nextMonthStart = new Date(monthStarts[index]);
                    nextMonthStart.setMonth(nextMonthStart.getMonth() + 1);
                    const daysInMonth = (nextMonthStart - monthStarts[index]) / (1000 * 60 * 60 * 24);
                    const widthPercent = (daysInMonth / totalWidthInDays) * 100;
                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'gantt-month text-sm md:text-base';
                    monthDiv.textContent = month;
                    monthDiv.style.width = `${widthPercent}%`;
                    timelineDiv.appendChild(monthDiv);
                });

                headerRow.appendChild(timelineDiv);
                container.appendChild(headerRow);

                // Créer une palette de couleurs et un mappage
                const colors = ['#63b3ed', '#68d391', '#f6ad55', '#fc8181', '#a562ed', '#4fd1c5'];
                const colorMap = {};
                let colorIndex = 0;

                // Afficher chaque tâche
                const tasksContainer = document.createElement('div');
                tasksContainer.className = 'gantt-tasks';
                
                tasks.forEach(task => {
                    const taskRow = document.createElement('div');
                    taskRow.className = 'gantt-task-row';
                    
                    const taskLabel = document.createElement('div');
                    taskLabel.className = 'gantt-task-label text-xs sm:text-sm';
                    taskLabel.textContent = task.Tâche;
                    
                    const parentId = task.ID.split('.')[0];
                    if (task.ID.includes('.')) {
                        taskLabel.classList.add('sub-task');
                    } else {
                        // Pour les tâches principales, assigner une nouvelle couleur
                        colorMap[parentId] = colors[colorIndex % colors.length];
                        colorIndex++;
                    }
                    taskRow.appendChild(taskLabel);

                    const taskBarContainer = document.createElement('div');
                    taskBarContainer.className = 'gantt-task-bar-container';

                    const durationDays = task.Durée_jours ? parseFloat(task.Durée_jours) : (task.end - task.start) / (1000 * 60 * 60 * 24);
                    const daysFromStart = (task.start - minDate) / (1000 * 60 * 60 * 24);
                    
                    const barDiv = document.createElement('div');
                    barDiv.className = 'gantt-task-bar text-gray-900';
                    barDiv.textContent = task.ID;
                    barDiv.style.width = `${(durationDays / totalDays) * 100}%`;
                    barDiv.style.left = `${(daysFromStart / totalDays) * 100}%`;
                    barDiv.style.backgroundColor = colorMap[parentId];

                    const tooltip = document.createElement('div');
                    tooltip.className = 'gantt-tooltip text-sm';
                    tooltip.innerHTML = `
                        <strong>${task.Tâche}</strong><br>
                        Début: ${task.Début}<br>
                        Fin: ${task.Fin}<br>
                        Durée: ${task.Durée_jours} jours<br>
                        Assigné: ${task.Assigné || 'Non assigné'}<br>
                        Notes: ${task.Notes || 'N/A'}
                    `;
                    barDiv.appendChild(tooltip);

                    taskBarContainer.appendChild(barDiv);
                    taskRow.appendChild(taskBarContainer);
                    tasksContainer.appendChild(taskRow);
                });
                
                container.appendChild(tasksContainer);
            };

            const data = parseCSV(csvData);
            renderGanttChart(data);
        });
    </script>

</body>
</html>
